<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title">Sale Register (Net Total)</h5>
        <div class="d-flex justify-content-end align-items-center">
            <div class="me-1">
                {% include 'commonutil/time_interval_select.html' %}
            </div>
            <div>
                {% include 'commonutil/time_interval_view.html' %}
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="chart w-100">
            <div id="apexcharts-line"></div>
        </div>
    </div>
</div>

<script>
  var chart;

  function populateLineChart(view) {
    var labels = [];
    var data = [];
    var aggregatedData = {};
  
    window.reportData.forEach(item => {
      var date = new Date(item["Invoice Date"]);
      var label;
  
      if (view === 'day') {
        label = date.toISOString().split('T')[0];
      } else if (view === 'week') {
        var weekStart = new Date(date.setDate(date.getDate() - date.getDay())).toISOString().split('T')[0];
        label = weekStart;
      } else if (view === 'month') {
        label = date.getFullYear() + '-' + ("0" + (date.getMonth() + 1)).slice(-2);
      } else if (view === 'year') {
        label = date.getFullYear().toString();
      }
  
      if (!aggregatedData[label]) {
        aggregatedData[label] = 0;
      }
      aggregatedData[label] += item["Net Total"];
    });
  
    labels = Object.keys(aggregatedData);
    data = Object.values(aggregatedData).map(value => Math.round(value)); // Round to nearest whole number
  
    var options = {
      chart: {
        height: 350,
        type: "line",
        zoom: {
          enabled: false
        },
        toolbar: {
          show: false // Disable the toolbar including download option
        }
      },
      dataLabels: {
        enabled: false
      },
      stroke: {
        width: [5],
        curve: "straight"
      },
      series: [{
        name: "Net Total",
        data: data
      }],
      markers: {
        size: 0,
        style: "hollow", // full, hollow, inverted
      },
      xaxis: {
        categories: labels,
      },
      tooltip: {
        y: {
          title: {
            formatter: function(val) {
              return val;
            }
          }
        }
      },
      grid: {
        borderColor: "#f1f1f1",
      }
    };
  
    if (chart) {
      chart.destroy();
      document.querySelector("#apexcharts-line").innerHTML = ""; // Clear the chart container
    }
    
    chart = new ApexCharts(
      document.querySelector("#apexcharts-line"),
      options
    );
    chart.render();
  }
</script>