<div class="card">
    <div class="card-header">
        <h5 class="card-title">Item Type Sales</h5>
    </div>
    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
        <table class="table table-striped table-bordered table-sm" id="item-type-sales-table">
         
            <tbody>
                <!-- Content will be populated by JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const apiUrl = '{% url 'report-datefilter-data-api' result.sale_purchase.report.id|default:"0" %}';
        var requestData = {};
        var currentDate = new Date();
        var lastYearDate = new Date();
        lastYearDate.setFullYear(currentDate.getFullYear() - 1);
        
        function formatDate(date) {
          var day = ("0" + date.getDate()).slice(-2);
          var month = ("0" + (date.getMonth() + 1)).slice(-2);
          var year = date.getFullYear();
          return year + '-' + month + '-' + day;
        }
    
        requestData = {
          start_date: formatDate(lastYearDate),
          end_date: formatDate(currentDate),
        };

        function populateTable(data) {
            const tableBody = document.querySelector("#item-type-sales-table tbody");
            tableBody.innerHTML = data.item_type_analysis;
        }

        $.ajax({
            url: apiUrl,
            type: 'GET',
            data: requestData,
            dataType: 'json',
            success: function(response) {
                if (response.data && response.data.item_type_analysis) {
                    populateTable(response.data);
                } else {
                    $('#item-type-sales-table tbody').html('<tr><td colspan="3" class="text-center">No data available</td></tr>');
                }
            },
            error: function(xhr, status, error) {
                $('#item-type-sales-table tbody').html('<tr><td colspan="3" class="text-center text-danger">Error fetching data</td></tr>');
            }
        });
    });
</script>
