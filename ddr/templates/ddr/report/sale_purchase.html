<div class="accordion" id="salesReportAccordion">
    <div class="card">
        <div class="card-header" id="headingSalesPerson">
            <h2 class="mb-0">
                <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSalesPerson" aria-expanded="false" aria-controls="collapseSalesPerson">
                    Sales Person
                </button>
            </h2>
        </div>
        <div id="collapseSalesPerson" class="collapse" aria-labelledby="headingSalesPerson" data-bs-parent="#salesReportAccordion">
            <div class="card-body">
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-striped table-bordered table-sm" id="sales-table">
                        <tbody>
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header" id="headingBranchSales">
            <h2 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBranchSales" aria-expanded="false" aria-controls="collapseBranchSales">
                    Branch Sales
                </button>
            </h2>
        </div>
        <div id="collapseBranchSales" class="collapse" aria-labelledby="headingBranchSales" data-bs-parent="#salesReportAccordion">
            <div class="card-body">
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-striped table-bordered table-sm" id="branch-sales-table">
                        <tbody>
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header" id="headingItemTypeSales">
            <h2 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseItemTypeSales" aria-expanded="false" aria-controls="collapseItemTypeSales">
                    Item Type Sales
                </button>
            </h2>
        </div>
        <div id="collapseItemTypeSales" class="collapse" aria-labelledby="headingItemTypeSales" data-bs-parent="#salesReportAccordion">
            <div class="card-body">
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-striped table-bordered table-sm" id="item-type-sales-table">
                        <tbody>
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header" id="headingSalesPersonItemType">
            <h2 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSalesPersonItemType" aria-expanded="false" aria-controls="collapseSalesPersonItemType">
                    Sales Person by Item Type
                </button>
            </h2>
        </div>
        <div id="collapseSalesPersonItemType" class="collapse" aria-labelledby="headingSalesPersonItemType" data-bs-parent="#salesReportAccordion">
            <div class="card-body">
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-striped table-bordered table-sm" id="individual-by-item-type-sales-table">
                        <tbody>
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header" id="headingBranchItemType">
            <h2 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBranchItemType" aria-expanded="false" aria-controls="collapseBranchItemType">
                    Branch by Item Type
                </button>
            </h2>
        </div>
        <div id="collapseBranchItemType" class="collapse" aria-labelledby="headingBranchItemType" data-bs-parent="#salesReportAccordion">
            <div class="card-body">
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-striped table-bordered table-sm" id="branch-by-item-type-sales-table">
                        <tbody>
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const apiUrl = '{% url 'report-datefilter-data-api' result.sale_purchase.report.id|default:"0" %}';
        var requestData = {};
        var currentDate = new Date();
        var lastYearDate = new Date();
        lastYearDate.setFullYear(currentDate.getFullYear() - 1);

        function formatDate(date) {
            var day = ("0" + date.getDate()).slice(-2);
            var month = ("0" + (date.getMonth() + 1)).slice(-2);
            var year = date.getFullYear();
            return year + '-' + month + '-' + day;
        }

        requestData = {
            start_date: formatDate(lastYearDate),
            end_date: formatDate(currentDate),
        };

        function populateTable(tableId, data) {
            const tableBody = document.querySelector(`#${tableId} tbody`);
            tableBody.innerHTML = data;
        }

        $.ajax({
            url: apiUrl,
            type: 'GET',
            data: requestData,
            dataType: 'json',
            success: function(response) {
                if (response.data) {
                    populateTable("sales-table", response.data.sales_analysis || '<tr><td colspan="3" class="text-center">No data available</td></tr>');
                    populateTable("branch-sales-table", response.data.branch_analysis || '<tr><td colspan="3" class="text-center">No data available</td></tr>');
                    populateTable("item-type-sales-table", response.data.item_type_analysis || '<tr><td colspan="3" class="text-center">No data available</td></tr>');
                    populateTable("individual-by-item-type-sales-table", response.data.individual_by_item_type_analysis || '<tr><td colspan="3" class="text-center">No data available</td></tr>');
                    populateTable("branch-by-item-type-sales-table", response.data.branch_by_item_type_analysis || '<tr><td colspan="3" class="text-center">No data available</td></tr>');
                } else {
                    $('#sales-table tbody').html('<tr><td colspan="3" class="text-center">No data available</td></tr>');
                    $('#branch-sales-table tbody').html('<tr><td colspan="3" class="text-center">No data available</td></tr>');
                    $('#item-type-sales-table tbody').html('<tr><td colspan="3" class="text-center">No data available</td></tr>');
                    $('#individual-by-item-type-sales-table tbody').html('<tr><td colspan="3" class="text-center">No data available</td></tr>');
                    $('#branch-by-item-type-sales-table tbody').html('<tr><td colspan="3" class="text-center">No data available</td></tr>');
                }
            },
            error: function(xhr, status, error) {
                $('#sales-table tbody').html('<tr><td colspan="3" class="text-center text-danger">Error fetching data</td></tr>');
                $('#branch-sales-table tbody').html('<tr><td colspan="3" class="text-center text-danger">Error fetching data</td></tr>');
                $('#item-type-sales-table tbody').html('<tr><td colspan="3" class="text-center text-danger">Error fetching data</td></tr>');
                $('#individual-by-item-type-sales-table tbody').html('<tr><td colspan="3" class="text-center text-danger">Error fetching data</td></tr>');
                $('#branch-by-item-type-sales-table tbody').html('<tr><td colspan="3" class="text-center text-danger">Error fetching data</td></tr>');
            }
        });
    });
</script>


<style>
    .card-header {
        background-color: var(--bs-card-cap-bg);
        border-bottom: var(--bs-card-border-width) solid var(--bs-card-border-color);
        color: var(--bs-card-cap-color);
        margin-bottom: 0;
        padding: var(--bs-card-cap-padding-y) var(--bs-card-cap-padding-x);
    }
</style>