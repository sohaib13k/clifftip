{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- Choose your prefered color scheme -->
    <link href="{% static 'css/light.css' %}" rel="stylesheet" />
    {% comment %}
    <link href="{% static 'css/dark.css' %}" rel="stylesheet" />
    {% endcomment %}
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
</head>
<body>
    <h2>Summary</h2>
    <div>Report name: {{ report }}</div>
    {% comment %} <div> Threshhold: {{ threshhold }} </div>
    <div> Total: {{ total}} </div>
    <div> Average: {{ average }} </div>
    <div style="color: red;"> Result: {{ result}} </div> {% endcomment %}

    <h2>Excel Data</h2>
    <a href="#" class="btn btn-primary">Download Excel</a>
    <hr>

    {% comment %} <div class="table-responsive">
    {{ report_excel|safe }} {% endcomment %}

    <button class="btn btn-primary" id="toggleButton">Show/Hide Excel Data</button>
    <div class="table-responsive" id="toggleContent" style="display:none;">
        {{ report_excel|safe }}
    </div>

    <hr>
    <div class="table-responsive">
        {{ sales_analysis|safe }}
    <div class="table-responsive">
        {{ branch_analysis|safe }}
    <div class="table-responsive">
        {{ item_type_analysis|safe }}
    <div class="table-responsive">
        {{ individual_by_item_type_analysis|safe }}
    <div class="table-responsive">
        {{ branch_by_item_type_analysis|safe }}

        <h2>Chart</h2>
        {% for i in myRange %}
        <div class="col-12 col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">Individual sale</h5>
                    {% comment %} <h6 class="card-subtitle text-muted">A column chart uses vertical bars to display data and is used to compare values across {% endcomment %}
                        categories.</h6>
                </div>
                <div class="card-body">
                    <div class="chart w-100">
                        <div id="apexcharts-column"></div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Parse the JSON data from the Django context
                var chartData = JSON.parse('{{ all_chart_data_json|safe }}');
                console.log(chartData);
            
                // Prepare data and labels
                var data = chartData.individual_chart_data.data;
                var labels = chartData.individual_chart_data.labels;
            
                // Combine the arrays: 'data' and 'labels'
                var combined = data.map(function(value, index) {
                    return { value: value, label: labels[index] };
                });
            
                // Sort combined array by the 'value' in descending order
                combined.sort(function(a, b) {
                    return b.value - a.value; // For descending sort
                });
            
                // Separate them back out
                var sortedData = combined.map(function(item) {
                    return item.value;
                });
                var sortedLabels = combined.map(function(item) {
                    return item.label;
                });
            
                // Column chart options
                var options = {
                    chart: {
                        height: 350,
                        type: "bar",
                    },
                    plotOptions: {
                        bar: {
                            horizontal: false,
                            endingShape: "rounded",
                            columnWidth: "55%",
                        },
                    },
                    dataLabels: {
                        enabled: false
                    },
                    stroke: {
                        show: true,
                        width: 2,
                        colors: ["transparent"]
                    },
                    series: [{
                        name: "Net Total Sales",
                        data: sortedData // Use the sorted data
                    }],
                    xaxis: {
                        categories: sortedLabels // Use the sorted labels
                    },
                    yaxis: {
                        title: {
                            text: "Net Total (₹)"
                        }
                    },
                    fill: {
                        opacity: 1
                    },
                    tooltip: {
                        y: {
                            formatter: function(val) {
                                return "₹ " + val;
                            }
                        }
                    }
                };
            
                var chart = new ApexCharts(document.querySelector("#apexcharts-column"), options);
                chart.render();
            });
            


            document.getElementById('toggleButton').addEventListener('click', function() {
                var content = document.getElementById('toggleContent');
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                } else {
                    content.style.display = 'none';
                }
            });
        </script>
        <script src="{% static 'js/app.js' %}"></script>

</body>
</html>